% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/apply_thresholds.R, R/apply_thresholds_ATF.R
\name{apply_thresholds}
\alias{apply_thresholds}
\title{Apply Confidence Score Thresholds to Predictions}
\usage{
apply_thresholds(atf, thresholds, type = c("shallow", "big"))

apply_thresholds(atf, thresholds, type = c("shallow", "big"))
}
\arguments{
\item{atf}{data.table or data.frame containing aggregated time-series
features, including columns \code{detID}, \code{german}, \code{conf}, etc.
as produced by \code{calculate_atf()}.}

\item{thresholds}{Either:
\itemize{
\item a \code{data.table} of threshold rules from \code{fit_thresholds_shallow()},
\item or a named list of \code{partykit::ctree} objects from \code{fit_thresholds_big()}.
}}

\item{type}{character, one of \code{"shallow"} or \code{"big"}, indicating
the format of \code{thresholds}.}

\item{predictions}{A \code{data.frame} containing model predictions, where the first
two columns are metadata (e.g., filename, offset) and all subsequent columns
are species confidence scores.}

\item{threshold}{Either a single numeric value (uniform threshold applied to all
species) or a \code{data.frame} with two columns: \code{species} (character) and
\code{cutoff} (numeric), defining species-specific thresholds.}

\item{metadata_cols}{Integer. The number of leading metadata columns in
\code{predictions} that should be preserved (default: \code{2}).}
}
\value{
A \code{data.frame} of the same shape as \code{predictions}, with confidence
scores replaced by \code{0} or \code{1} according to the thresholding rules.

data.table of detections with an additional column \code{keep}
indicating whether the detection passed the thresholding.
}
\description{
This function thresholds model predictions using either a uniform cutoff or
species-specific thresholds. Predictions greater than or equal to the chosen
threshold become \code{1}, and values below become \code{0}.

This function filters detections based on species-specific threshold rules,
either from the shallow Singer-style models (\code{fit_thresholds_shallow})
or from big-tree models (\code{fit_thresholds_big}).
}
\examples{
\dontrun{
# get data to try
data(predictions)

# Uniform threshold
bin_preds <- apply_thresholds(predictions, threshold = 0.5)

# load example species-specific thresholds
data(custom_thresholds)
bin_preds <- apply_thresholds(predictions, threshold = thresholds)
head(bin_preds)
}
}
